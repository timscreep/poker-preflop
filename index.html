<!doctype html>
<html lang="ru">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>Poker Range Master</title>
        <script src="https://cdn.tailwindcss.com"></script>

        <style>
            :root {
                --base: #1e1e2e;
                --surface0: #313244;
                --surface1: #45475a;
                --text: #cdd6f4;
                --mauve: #cba6f7;
                --red: #f38ba8;
                --green: #a6e3a1;
                --blue: #89b4fa;
                --yellow: #f9e2af;
                --peach: #fab387;
            }

            body {
                font-family: "Segoe UI", Inter, sans-serif;
                background: var(--base);
                color: var(--text);
                min-height: 100vh;
                display: flex;
                flex-direction: column;
                align-items: center;
                user-select: none;
            }

            /* --- TABS --- */
            .nav-tabs {
                display: flex;
                gap: 10px;
                margin: 20px 0;
                background: var(--surface0);
                padding: 6px;
                border-radius: 12px;
            }
            .tab-btn {
                padding: 8px 24px;
                border-radius: 8px;
                font-weight: 600;
                color: var(--text);
                opacity: 0.7;
                transition: all 0.2s;
            }
            .tab-btn:hover {
                opacity: 1;
                background: var(--surface1);
            }
            .tab-btn.active {
                background: var(--mauve);
                color: #1e1e2e;
                opacity: 1;
            }

            /* --- EDITOR --- */
            .toolbar {
                display: flex;
                gap: 8px;
                flex-wrap: wrap;
                justify-content: center;
                margin-bottom: 10px;
            }
            .matrix {
                display: grid;
                grid-template-columns: repeat(13, 1fr);
                gap: 2px;
                background: var(--surface0);
                padding: 5px;
                border-radius: 8px;
                width: 100%;
                max-width: 500px;
            }
            .cell {
                aspect-ratio: 1;
                background: var(--surface1);
                display: flex;
                align-items: center;
                justify-content: center;
                border-radius: 3px;
                cursor: pointer;
                font-size: 10px;
                color: var(--text);
            }

            .color-dot {
                width: 30px;
                height: 30px;
                border-radius: 6px;
                cursor: pointer;
                border: 2px solid transparent;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                color: rgba(0, 0, 0, 0.5);
            }
            .color-dot.selected {
                border-color: white;
                transform: scale(1.1);
                box-shadow: 0 0 10px rgba(255, 255, 255, 0.2);
            }

            /* --- CARDS (4-Color Deck style) --- */
            .card {
                width: 80px;
                height: 112px;
                border-radius: 10px;
                position: relative;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
                display: flex;
                flex-direction: column;
                padding: 8px;
                font-family: "Courier New", monospace;
                font-weight: bold;
                color: white; /* –í—Å–µ–≥–¥–∞ –±–µ–ª—ã–π —Ç–µ–∫—Å—Ç */
                border: 2px solid rgba(255, 255, 255, 0.1);
            }

            /* –ú–∞—Å—Ç–∏ - –∑–∞–ª–∏–≤–∫–∞ —Ñ–æ–Ω–∞ */
            .card.spades {
                background: linear-gradient(135deg, #2d3436, #000000);
            } /* –ü–∏–∫–∏ - –ß–µ—Ä–Ω—ã–π/–°–µ—Ä—ã–π */
            .card.hearts {
                background: linear-gradient(135deg, #e11d48, #9f1239);
            } /* –ß–µ—Ä–≤–∏ - –ö—Ä–∞—Å–Ω—ã–π */
            .card.clubs {
                background: linear-gradient(135deg, #16a34a, #14532d);
            } /* –¢—Ä–µ—Ñ—ã - –ó–µ–ª–µ–Ω—ã–π */
            .card.diamonds {
                background: linear-gradient(135deg, #2563eb, #1e3a8a);
            } /* –ë—É–±–Ω—ã - –°–∏–Ω–∏–π */

            .card .rank {
                font-size: 28px;
                line-height: 1;
                text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.3);
            }
            .card .suit {
                font-size: 36px;
                position: absolute;
                bottom: 6px;
                right: 8px;
                line-height: 1;
                opacity: 0.9;
            }

            /* --- UTILS --- */
            .btn {
                padding: 8px 16px;
                border-radius: 8px;
                background: var(--surface1);
                transition: 0.2s;
            }
            .btn:hover {
                filter: brightness(1.2);
            }
            .btn.primary {
                background: var(--mauve);
                color: #1e1e2e;
                font-weight: bold;
            }
            .hidden {
                display: none !important;
            }
        </style>
    </head>

    <body class="p-4">
        <div class="flex items-center gap-3 mb-4">
            <h1 class="text-2xl font-bold text-[#cba6f7]">
                Poker Range Master
            </h1>
        </div>

        <div
            class="bg-[#313244] p-3 rounded-xl mb-4 flex gap-3 flex-wrap justify-center w-full max-w-xl"
        >
            <select
                id="modeSel"
                class="bg-[#45475a] text-white px-3 py-2 rounded border border-gray-600 outline-none"
            >
                <option value="RFI">RFI (Open)</option>
                <option value="vs3bet">vs 3-Bet</option>
                <option value="vs4bet">vs 4-Bet</option>
            </select>

            <select
                id="heroSel"
                class="bg-[#45475a] text-white px-3 py-2 rounded border border-gray-600 outline-none"
            >
                <option>UTG</option>
                <option>MP</option>
                <option>CO</option>
                <option>BTN</option>
                <option>SB</option>
                <option>BB</option>
            </select>

            <button
                id="loadChartBtn"
                class="btn bg-blue-600 text-white flex items-center gap-2"
            >
                <span>üîÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å / –°—Ç–∞—Ä—Ç</span>
            </button>
        </div>

        <div class="nav-tabs">
            <button class="tab-btn active" onclick="switchTab('editor')">
                –†–µ–¥–∞–∫—Ç–æ—Ä
            </button>
            <button class="tab-btn" onclick="switchTab('trainer')">
                –¢—Ä–µ–Ω–∞–∂–µ—Ä
            </button>
        </div>

        <div id="view-editor" class="w-full flex flex-col items-center">
            <div class="flex gap-2 mb-4">
                <div
                    class="color-dot"
                    data-action="raise"
                    style="background: var(--red)"
                >
                    R
                </div>
                <div
                    class="color-dot"
                    data-action="call"
                    style="background: var(--green)"
                >
                    C
                </div>
                <div
                    class="color-dot"
                    data-action="3bet"
                    style="background: var(--peach)"
                >
                    3B
                </div>
                <div
                    class="color-dot"
                    data-action="4bet"
                    style="background: var(--yellow)"
                >
                    4B
                </div>
                <div
                    class="color-dot"
                    data-action="fold"
                    style="background: var(--blue)"
                >
                    F
                </div>
                <div
                    class="color-dot"
                    data-action="erase"
                    style="background: #444; color: white"
                >
                    ‚úï
                </div>
            </div>

            <div id="matrix" class="matrix mb-4"></div>

            <div class="flex gap-2">
                <button id="clearBtn" class="btn text-red-300">–û—á–∏—Å—Ç–∏—Ç—å</button>
                <button id="saveBtn" class="btn primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å JSON</button>
                <label class="btn cursor-pointer">
                    –ò–º–ø–æ—Ä—Ç —Ñ–∞–π–ª–∞
                    <input id="fileIn" type="file" accept=".json" hidden />
                </label>
            </div>
            <div id="statusMsg" class="h-6 mt-2 text-sm text-green-400"></div>
        </div>

        <div
            id="view-trainer"
            class="hidden w-full max-w-md flex flex-col items-center"
        >
            <div
                class="flex justify-between w-full px-4 mb-6 text-sm text-gray-400"
            >
                <span id="current-chart-name">Chart: Custom</span>
                <span id="score-display">0/0 (0%)</span>
            </div>

            <div class="flex gap-6 mb-10" id="hand-container"></div>

            <div
                id="feedback"
                class="h-8 text-xl font-bold mb-4 text-center"
            ></div>

            <div class="grid grid-cols-2 gap-3 w-full">
                <button
                    class="act-btn btn py-4 text-lg font-bold bg-blue-500/20 hover:bg-blue-500/40 text-blue-200 border border-blue-500/50"
                    data-act="fold"
                >
                    FOLD
                </button>
                <button
                    class="act-btn btn py-4 text-lg font-bold bg-green-500/20 hover:bg-green-500/40 text-green-200 border border-green-500/50"
                    data-act="call"
                >
                    CALL
                </button>
                <button
                    class="act-btn btn py-4 text-lg font-bold bg-red-500/20 hover:bg-red-500/40 text-red-200 border border-red-500/50"
                    data-act="raise"
                >
                    RAISE
                </button>
                <button
                    class="act-btn btn py-4 text-lg font-bold bg-orange-500/20 hover:bg-orange-500/40 text-orange-200 border border-orange-500/50"
                    data-act="3bet"
                >
                    3-BET
                </button>
                <button
                    class="act-btn btn py-4 text-lg font-bold col-span-2 bg-yellow-500/20 hover:bg-yellow-500/40 text-yellow-200 border border-yellow-500/50"
                    data-act="4bet"
                >
                    4-BET
                </button>
            </div>

            <button
                id="nextHandBtn"
                class="btn mt-6 w-full py-3 bg-neutral-700 hidden"
            >
                –î–∞–ª—å—à–µ ‚Üí
            </button>
        </div>

        <script>
            /* ================= CONFIG ================= */
            const ACTION_COLORS = {
                raise: "var(--red)",
                call: "var(--green)",
                "3bet": "var(--peach)",
                "4bet": "var(--yellow)",
                fold: "var(--blue)",
            };

            // 4-Color Deck Configuration
            const SUITS = [
                { s: "s", char: "‚ô†", css: "spades" }, // Black/Gray
                { s: "h", char: "‚ô•", css: "hearts" }, // Red
                { s: "d", char: "‚ô¶", css: "diamonds" }, // Blue
                { s: "c", char: "‚ô£", css: "clubs" }, // Green
            ];
            const RANKS = [
                "A",
                "K",
                "Q",
                "J",
                "T",
                "9",
                "8",
                "7",
                "6",
                "5",
                "4",
                "3",
                "2",
            ];

            let rangeData = {};
            let stats = { correct: 0, total: 0 };
            let currentHandObj = null;

            /* ================= EDITOR LOGIC ================= */
            const matrixEl = document.getElementById("matrix");
            let currentAction = "raise";
            let isPainting = false;

            // 1. Build Matrix
            function initMatrix() {
                matrixEl.innerHTML = "";
                RANKS.forEach((r1, i) => {
                    RANKS.forEach((r2, j) => {
                        let hand =
                            i === j
                                ? r1 + r2
                                : i < j
                                  ? r1 + r2 + "s"
                                  : r2 + r1 + "o";
                        const c = document.createElement("div");
                        c.className = "cell";
                        c.dataset.hand = hand;
                        c.textContent = hand;
                        c.onmousedown = (e) => {
                            isPainting = true;
                            paint(c);
                        };
                        c.onmouseenter = (e) => {
                            if (isPainting) paint(c);
                        };
                        matrixEl.appendChild(c);
                    });
                });
            }
            initMatrix();
            window.onmouseup = () => (isPainting = false);

            // 2. Painting
            function paint(cell) {
                const hand = cell.dataset.hand;
                if (currentAction === "erase") {
                    delete rangeData[hand];
                    cell.style.background = "";
                    cell.style.color = "";
                    cell.removeAttribute("data-act");
                } else {
                    rangeData[hand] = currentAction;
                    cell.dataset.act = currentAction;
                    cell.style.background = ACTION_COLORS[currentAction];
                    cell.style.color = "#000"; // Text black on matrix for readability
                }
            }

            function repaintMatrix() {
                document.querySelectorAll(".cell").forEach((c) => {
                    const act = rangeData[c.dataset.hand];
                    if (act) {
                        c.dataset.act = act;
                        c.style.background = ACTION_COLORS[act];
                        c.style.color = "#000";
                    } else {
                        c.removeAttribute("data-act");
                        c.style.background = "";
                        c.style.color = "";
                    }
                });
            }

            // 3. Toolbar
            document.querySelectorAll(".color-dot").forEach((d) => {
                d.onclick = () => {
                    document
                        .querySelectorAll(".color-dot")
                        .forEach((x) => x.classList.remove("selected"));
                    d.classList.add("selected");
                    currentAction = d.dataset.action;
                };
            });
            document.querySelector('[data-action="raise"]').click();

            // 4. Load/Save/Clear
            document.getElementById("clearBtn").onclick = () => {
                rangeData = {};
                repaintMatrix();
            };

            document.getElementById("saveBtn").onclick = () => {
                const name = `${document.getElementById("modeSel").value}_${document.getElementById("heroSel").value}.json`;
                const blob = new Blob([JSON.stringify(rangeData, null, 2)], {
                    type: "application/json",
                });
                const a = document.createElement("a");
                a.href = URL.createObjectURL(blob);
                a.download = name;
                a.click();
            };

            const fileIn = document.getElementById("fileIn");
            fileIn.onchange = (e) => {
                const f = e.target.files[0];
                if (!f) return;
                const r = new FileReader();
                r.onload = (ev) => {
                    rangeData = JSON.parse(ev.target.result);
                    repaintMatrix();
                    showStatus("–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω –≤—Ä—É—á–Ω—É—é!");
                };
                r.readAsText(f);
            };

            /* ================= DATA LOADING LOGIC ================= */

            async function tryLoadFromChartsFolder() {
                const mode = document.getElementById("modeSel").value;
                const hero = document.getElementById("heroSel").value;
                // –ò–º—è —Ñ–∞–π–ª–∞: charts/RFI_UTG.json
                const path = `charts/${mode}_${hero}.json`;

                showStatus("–ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ " + path + "...");

                try {
                    const res = await fetch(path);
                    if (!res.ok) throw new Error("404");
                    const data = await res.json();

                    rangeData = data;
                    repaintMatrix(); // Update editor view

                    document.getElementById("current-chart-name").textContent =
                        `Chart: ${mode} ${hero}`;
                    showStatus("–£—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ –∏–∑ –ø–∞–ø–∫–∏!");

                    // Reset stats
                    stats = { correct: 0, total: 0 };
                    updateScore();
                    nextHand(); // Deal new hand
                } catch (e) {
                    console.warn(e);
                    showStatus(
                        "–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ø–∞–ø–∫–µ /charts. –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â–∏–π —Ä–µ–¥–∞–∫—Ç–æ—Ä.",
                    );
                    document.getElementById("current-chart-name").textContent =
                        `Chart: Editor Custom`;
                    nextHand();
                }
            }

            document.getElementById("loadChartBtn").onclick = () => {
                tryLoadFromChartsFolder();
            };

            function showStatus(msg) {
                const el = document.getElementById("statusMsg");
                el.textContent = msg;
                setTimeout(() => (el.textContent = ""), 3000);
            }

            /* ================= TRAINER LOGIC ================= */

            function switchTab(t) {
                document
                    .querySelectorAll(".tab-btn")
                    .forEach((b) => b.classList.remove("active"));
                document
                    .querySelector(`[onclick="switchTab('${t}')"]`)
                    .classList.add("active");
                if (t === "editor") {
                    document
                        .getElementById("view-editor")
                        .classList.remove("hidden");
                    document
                        .getElementById("view-trainer")
                        .classList.add("hidden");
                } else {
                    document
                        .getElementById("view-editor")
                        .classList.add("hidden");
                    document
                        .getElementById("view-trainer")
                        .classList.remove("hidden");
                    if (Object.keys(rangeData).length === 0)
                        tryLoadFromChartsFolder();
                }
            }

            function getRandom(arr) {
                return arr[Math.floor(Math.random() * arr.length)];
            }

            function genHand() {
                let r1 = getRandom(RANKS),
                    r2 = getRandom(RANKS);
                let s1 = getRandom(SUITS),
                    s2 = getRandom(SUITS);

                // Avoid identical cards
                if (r1 === r2 && s1.s === s2.s)
                    s2 = SUITS[(SUITS.indexOf(s1) + 1) % 4];

                // Determine combo key (AKs, AA, 72o)
                let idx1 = RANKS.indexOf(r1),
                    idx2 = RANKS.indexOf(r2);
                let combo;
                if (idx1 < idx2) combo = r1 + r2 + (s1.s === s2.s ? "s" : "o");
                else if (idx1 > idx2)
                    combo = r2 + r1 + (s1.s === s2.s ? "s" : "o");
                else combo = r1 + r2;

                return { r1, r2, s1, s2, combo };
            }

            function renderCard(r, s) {
                return `
                <div class="card ${s.css}">
                    <div class="rank">${r}</div>
                    <div class="suit">${s.char}</div>
                </div>`;
            }

            function nextHand() {
                document.getElementById("feedback").textContent = "";
                document.getElementById("nextHandBtn").classList.add("hidden");
                toggleButtons(true);

                currentHandObj = genHand();
                document.getElementById("hand-container").innerHTML =
                    renderCard(currentHandObj.r1, currentHandObj.s1) +
                    renderCard(currentHandObj.r2, currentHandObj.s2);
            }

            function check(userAct) {
                const correct = rangeData[currentHandObj.combo] || "fold";

                stats.total++;
                const fb = document.getElementById("feedback");

                if (userAct === correct) {
                    stats.correct++;
                    fb.innerHTML = `<span class="text-green-400">‚úì Correct</span>`;
                    setTimeout(nextHand, 400); // Quick proceed
                } else {
                    fb.innerHTML = `<span class="text-red-400">‚úó Wrong. Correct: ${correct.toUpperCase()}</span>`;
                    toggleButtons(false);
                    document
                        .getElementById("nextHandBtn")
                        .classList.remove("hidden");
                }
                updateScore();
            }

            function updateScore() {
                const p =
                    stats.total === 0
                        ? 0
                        : Math.round((stats.correct / stats.total) * 100);
                document.getElementById("score-display").textContent =
                    `${stats.correct}/${stats.total} (${p}%)`;
            }

            function toggleButtons(on) {
                const pointer = on ? "auto" : "none";
                const opacity = on ? "1" : "0.5";
                document.querySelectorAll(".act-btn").forEach((b) => {
                    b.style.pointerEvents = pointer;
                    b.style.opacity = opacity;
                });
            }

            document.querySelectorAll(".act-btn").forEach((b) => {
                b.onclick = () => check(b.dataset.act);
            });
            document.getElementById("nextHandBtn").onclick = nextHand;
        </script>
    </body>
</html>
