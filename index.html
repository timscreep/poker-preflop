<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <title>Gemini Poker GTO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@500&family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --base: #11111b; --surf: #1e1e2e; --overlay: #313244;
            --text: #cdd6f4; --mauve: #cba6f7; --red: #f38ba8;
            --green: #a6e3a1; --blue: #89b4fa; --peach: #fab387;
        }
        body { background-color: var(--base); color: var(--text); font-family: 'Plus Jakarta Sans', sans-serif; height: 100vh; overflow: hidden; }
        
        /* Sidebar */
        .sidebar-item { @apply flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 cursor-pointer; }
        .sidebar-item.active { background-color: var(--mauve); color: var(--base); font-weight: 800; }
        .sidebar-item:not(.active):hover { background-color: var(--overlay); }

        /* GTO Slider */
        .slider-track { height: 32px; border-radius: 12px; position: relative; overflow: hidden; background: var(--blue); border: 2px solid var(--overlay); }
        .handle { 
            position: absolute; width: 12px; height: 40px; background: white; 
            top: -4px; border-radius: 6px; cursor: col-resize; z-index: 30;
            box-shadow: 0 0 10px rgba(0,0,0,0.5); border: 2px solid var(--mauve);
        }

        /* Matrix 13x13 */
        .matrix-grid { display: grid; grid-template-columns: repeat(13, 1fr); gap: 2px; }
        .cell { aspect-ratio: 1; position: relative; overflow: hidden; cursor: pointer; border-radius: 2px; font-size: 10px; font-weight: 600; display: flex; align-items: center; justify-content: center; }
        .cell-bg { position: absolute; inset: 0; display: flex; flex-direction: column; }
        .cell-text { position: relative; z-index: 10; pointer-events: none; text-shadow: 0 1px 2px rgba(0,0,0,0.8); }

        /* Poker Cards */
        .card { width: 75px; height: 105px; border-radius: 10px; @apply flex flex-col p-3 font-black text-white shadow-lg border border-white/10; }
        .card.s { background: #313244; } .card.h { background: var(--red); }
        .card.c { background: #238636; color: white; } .card.d { background: var(--blue); }

        .btn-action { @apply p-4 rounded-2xl font-extrabold text-sm transition-all active:scale-95; border: 1px solid rgba(255,255,255,0.05); }
        .hidden { display: none !important; }
    </style>
</head>
<body class="flex">

    <aside class="w-64 border-r border-overlay p-6 flex flex-col gap-8 bg-[#11111b] h-full">
        <div class="px-4 text-2xl font-extrabold tracking-tighter text-mauve">GEMINI<span class="text-text">GTO</span></div>
        
        <nav class="flex flex-col gap-2">
            <div onclick="switchView('ed')" id="tab-ed" class="sidebar-item active">
                <span>Editor</span>
            </div>
            <div onclick="switchView('lib')" id="tab-lib" class="sidebar-item">
                <span>Library</span>
            </div>
            <div onclick="switchView('tr')" id="tab-tr" class="sidebar-item">
                <span>Trainer</span>
            </div>
        </nav>

        <div class="mt-auto bg-surf p-4 rounded-2xl border border-overlay">
            <div class="text-[10px] uppercase font-bold opacity-40 mb-3">Statistics</div>
            <div class="flex flex-col gap-2">
                <div class="flex justify-between"><span class="text-xs">Correct:</span> <span id="st-ok" class="text-green font-bold">0</span></div>
                <div class="flex justify-between"><span class="text-xs">Wrong:</span> <span id="st-err" class="text-red font-bold">0</span></div>
                <div class="h-1 bg-overlay rounded-full mt-1 overflow-hidden">
                    <div id="st-bar" class="h-full bg-mauve w-0 transition-all"></div>
                </div>
            </div>
        </div>
    </aside>

    <main class="flex-1 flex flex-col overflow-hidden">
        
        <header id="config-bar" class="h-20 border-b border-overlay px-8 flex items-center justify-between bg-[#11111b]/50 backdrop-blur-md">
            <div class="flex gap-4">
                <select id="mode" onchange="syncUI()" class="bg-surf px-3 py-2 rounded-xl text-xs font-bold border border-overlay outline-none">
                    <option value="RFI">RFI</option><option value="vsOpen">vs Open</option><option value="vs3bet">vs 3-Bet</option>
                </select>
                <select id="hero" onchange="syncUI()" class="bg-surf px-3 py-2 rounded-xl text-xs font-bold border border-overlay outline-none">
                    <option>UTG</option><option>MP</option><option>CO</option><option>BTN</option><option>SB</option><option>BB</option>
                </select>
                <select id="villain" class="bg-surf px-3 py-2 rounded-xl text-xs font-bold border border-overlay outline-none w-20"></select>
                <label class="flex items-center gap-2 cursor-pointer ml-4">
                    <input type="checkbox" id="rnd-hero" class="w-4 h-4 accent-mauve">
                    <span class="text-[10px] uppercase font-bold opacity-60">Random Hero</span>
                </label>
            </div>
            <div class="flex gap-2">
                <button id="start-btn" onclick="startTrainer()" class="bg-mauve text-base px-6 py-2 rounded-xl font-bold text-xs">Start Session</button>
                <button id="stop-btn" onclick="stopTrainer()" class="bg-red text-base px-6 py-2 rounded-xl font-bold text-xs hidden">Stop</button>
            </div>
        </header>

        <div class="flex-1 overflow-y-auto p-8 flex flex-col items-center">
            
            <div id="view-ed" class="w-full flex flex-col items-center gap-8">
                <div class="w-full max-w-xl bg-surf p-6 rounded-3xl border border-overlay shadow-2xl">
                    <div class="flex justify-between text-xs font-black mb-4">
                        <span class="text-red">RAISE: <span id="v-r">30</span>%</span>
                        <span class="text-green">CALL: <span id="v-c">40</span>%</span>
                        <span class="text-blue">FOLD: <span id="v-f">30</span>%</span>
                    </div>
                    <div class="slider-track" id="slider-root">
                        <div class="absolute h-full bg-red transition-all" id="bar-r" style="width: 30%"></div>
                        <div class="absolute h-full bg-green transition-all" id="bar-c" style="left: 30%; width: 40%"></div>
                        <div class="handle" id="h1" style="left: 30%"></div>
                        <div class="handle" id="h2" style="left: 70%"></div>
                    </div>
                </div>
                <div id="matrix" class="matrix-grid w-full max-w-[580px] bg-overlay p-[2px] rounded-lg"></div>
            </div>

            <div id="view-tr" class="hidden w-full flex flex-col items-center gap-10">
                <div id="alert" class="hidden w-full max-w-md p-4 rounded-2xl flex items-center gap-3 animate-bounce"></div>

                <div class="flex gap-16 items-center">
                    <div class="relative w-64 h-32 border-4 border-overlay rounded-[100px] flex items-center justify-center">
                        <div id="node-h" class="absolute -top-5 left-1/2 -translate-x-1/2 px-3 py-1 bg-mauve text-base text-[10px] font-black rounded-full">HERO</div>
                        <div id="node-v" class="absolute -bottom-5 left-1/2 -translate-x-1/2 px-3 py-1 bg-red text-base text-[10px] font-black rounded-full">VILLAIN</div>
                        <div class="text-center">
                            <div class="text-[10px] opacity-40 font-bold uppercase">Spot</div>
                            <div id="spot-txt" class="text-lg font-black tracking-tighter"></div>
                        </div>
                    </div>
                    <div id="cards-spot" class="flex gap-4"></div>
                </div>

                <div class="grid grid-cols-2 gap-4 w-full max-w-md">
                    <button onclick="tAct('raise')" class="btn-action bg-red/10 text-red hover:bg-red hover:text-base">RAISE</button>
                    <button id="t-call" onclick="tAct('call')" class="btn-action bg-green/10 text-green hover:bg-green hover:text-base">CALL</button>
                    <button onclick="tAct('fold')" class="btn-action bg-blue/10 text-blue hover:bg-blue hover:text-base col-span-2">FOLD</button>
                </div>
                <button id="nxt" onclick="deal()" class="hidden bg-white text-base px-12 py-3 rounded-full font-black text-xs uppercase tracking-widest">Next Hand</button>
            </div>
        </div>
    </main>

<script>
    const RANKS = "AKQJT98765432".split("");
    const POS = ["UTG", "MP", "CO", "BTN", "SB", "BB"];
    let rangeData = {}, stats = { ok: 0, err: 0 }, trainerRunning = false;
    
    // Slider Logic
    let f1 = 30, f2 = 70;
    const root = document.getElementById('slider-root');
    const h1 = document.getElementById('h1'), h2 = document.getElementById('h2');

    function updateBars() {
        document.getElementById('bar-r').style.width = f1 + '%';
        document.getElementById('bar-c').style.left = f1 + '%';
        document.getElementById('bar-c').style.width = (f2 - f1) + '%';
        h1.style.left = `calc(${f1}% - 6px)`; h2.style.left = `calc(${f2}% - 6px)`;
        document.getElementById('v-r').innerText = f1;
        document.getElementById('v-c').innerText = f2 - f1;
        document.getElementById('v-f').innerText = 100 - f2;
    }

    [h1, h2].forEach((h, i) => {
        h.onmousedown = (e) => {
            const move = (em) => {
                let rect = root.getBoundingClientRect();
                let x = Math.round(((em.clientX - rect.left) / rect.width) * 100);
                x = Math.max(0, Math.min(100, x));
                if (i === 0) f1 = Math.min(x, f2); else f2 = Math.max(x, f1);
                updateBars();
            };
            window.onmousemove = move;
            window.onmouseup = () => window.onmousemove = null;
        };
    });

    function init() {
        const mx = document.getElementById('matrix');
        RANKS.forEach((r1, i) => {
            RANKS.forEach((r2, j) => {
                const combo = i < j ? r1+r2+'s' : (i > j ? r2+r1+'o' : r1+r2);
                const cell = document.createElement('div');
                cell.className = 'cell'; cell.dataset.hand = combo;
                cell.innerHTML = `<div class="cell-bg"></div><div class="cell-text">${combo}</div>`;
                cell.onmousedown = () => { if(!trainerRunning) { rangeData[combo] = {r:f1, c:f2-f1}; renderMatrix(); } };
                mx.appendChild(cell);
            });
        });
        renderMatrix(); syncUI(); updateBars();
    }

    function renderMatrix() {
        document.querySelectorAll('.cell').forEach(c => {
            const d = rangeData[c.dataset.hand] || {r:0, c:0};
            c.querySelector('.cell-bg').innerHTML = `
                <div style="height:${d.r}%; background:var(--red)"></div>
                <div style="height:${d.c}%; background:var(--green)"></div>
                <div style="flex:1; background:var(--blue)"></div>`;
        });
    }

    function switchView(v) {
        if(trainerRunning && v !== 'tr') return showAlert("Stop trainer first!", "red");
        document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('active'));
        document.getElementById('tab-'+v).classList.add('active');
        document.getElementById('view-ed').classList.toggle('hidden', v==='tr');
        document.getElementById('view-tr').classList.toggle('hidden', v!=='tr');
    }

    function syncUI() {
        const m = document.getElementById('mode').value, h = document.getElementById('hero'), v = document.getElementById('villain');
        h.options[5].disabled = (m === 'RFI');
        if (m === 'RFI' && h.value === 'BB') h.value = 'SB';
        v.innerHTML = '';
        const idx = POS.indexOf(h.value);
        if(m === 'vsOpen') POS.slice(0, idx).forEach(p => v.add(new Option(p,p)));
        if(m === 'vs3bet') POS.slice(idx + 1).forEach(p => v.add(new Option(p,p)));
        v.parentElement.classList.toggle('hidden', m==='RFI');
    }

    function startTrainer() {
        trainerRunning = true;
        document.getElementById('start-btn').classList.add('hidden');
        document.getElementById('stop-btn').classList.remove('hidden');
        switchView('tr'); deal();
    }

    function stopTrainer() {
        trainerRunning = false;
        document.getElementById('start-btn').classList.remove('hidden');
        document.getElementById('stop-btn').classList.add('hidden');
        document.getElementById('alert').classList.add('hidden');
    }

    function deal() {
        if(document.getElementById('rnd-hero').checked) {
            document.getElementById('hero').value = POS[Math.floor(Math.random()*6)];
            syncUI();
        }
        const m = document.getElementById('mode').value, h = document.getElementById('hero').value, v = document.getElementById('villain').value;
        document.getElementById('nxt').classList.add('hidden');
        document.getElementById('alert').classList.add('hidden');
        document.getElementById('spot-txt').innerText = m === 'RFI' ? `${h} (RFI)` : `${h} vs ${v}`;
        document.getElementById('t-call').classList.toggle('opacity-20', m==='RFI');

        const r1 = RANKS[Math.floor(Math.random()*13)], r2 = RANKS[Math.floor(Math.random()*13)];
        const s1 = ["s","h","c","d"][Math.floor(Math.random()*4)], s2 = ["s","h","c","d"][Math.floor(Math.random()*4)];
        if(r1===r2 && s1===s2) return deal();
        
        const i1 = RANKS.indexOf(r1), i2 = RANKS.indexOf(r2);
        currentHand = { combo: i1 < i2 ? r1+r2+(s1===s2?'s':'o') : (i1 > i2 ? r2+r1+(s1===s2?'s':'o') : r1+r2) };
        const suits = {s:'♠', h:'♥', c:'♣', d:'♦'};
        document.getElementById('cards-spot').innerHTML = `
            <div class="card ${s1}"><div>${r1}</div><div class="text-3xl mt-auto self-end">${suits[s1]}</div></div>
            <div class="card ${s2}"><div>${r2}</div><div class="text-3xl mt-auto self-end">${suits[s2]}</div></div>`;
    }

    function tAct(uA) {
        if(!document.getElementById('nxt').classList.contains('hidden')) return;
        const d = rangeData[currentHand.combo] || {r:0, c:0};
        let win = (uA==='raise' && d.r>0) || (uA==='call' && d.c>0) || (uA==='fold' && (d.r+d.c)<100);
        
        if(win) { stats.ok++; showAlert("CORRECT ACTION", "green"); setTimeout(deal, 800); }
        else { stats.err++; showAlert(`WRONG: Best was ${d.r > d.c ? 'RAISE' : (d.c>0?'CALL':'FOLD')}`, "red"); document.getElementById('nxt').classList.remove('hidden'); }
        updateStats();
    }

    function updateStats() {
        document.getElementById('st-ok').innerText = stats.ok;
        document.getElementById('st-err').innerText = stats.err;
        const perc = (stats.ok / (stats.ok + stats.err)) * 100 || 0;
        document.getElementById('st-bar').style.width = perc + '%';
    }

    function showAlert(txt, clr) {
        const a = document.getElementById('alert');
        a.className = `w-full max-w-md p-4 rounded-2xl flex items-center justify-center font-black text-xs bg-${clr}/20 text-${clr} border border-${clr}/30`;
        a.innerText = txt; a.classList.remove('hidden');
    }

    init();
</script>
</body>
</html>
