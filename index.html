<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <title>GTO Trainer Pro v2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --base: #0b0e14; --surf: #161b22; --text: #c9d1d9; --accent: #58a6ff; 
                --red: #f38ba8; --green: #a6e3a1; --blue: #89b4fa; }
        body { background: var(--base); color: var(--text); font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; align-items: center; }
        
        /* Слайдер 3-в-1 */
        .slider-root { width: 100%; height: 32px; background: var(--blue); position: relative; border-radius: 8px; overflow: hidden; cursor: pointer; border: 1px solid #30363d; }
        .bar-raise { position: absolute; height: 100%; background: var(--red); left: 0; }
        .bar-call { position: absolute; height: 100%; background: var(--green); }
        .handle { position: absolute; width: 6px; height: 100%; background: white; cursor: col-resize; z-index: 10; transform: translateX(-50%); box-shadow: 0 0 5px rgba(0,0,0,0.5); }

        .matrix { display: grid; grid-template-columns: repeat(13, 1fr); gap: 1px; background: #30363d; }
        .cell { width: 38px; height: 38px; background: var(--blue); display: flex; align-items: center; justify-content: center; font-size: 10px; cursor: pointer; position: relative; overflow: hidden; border-radius: 2px; }
        .cell-bg { position: absolute; inset: 0; display: flex; flex-direction: column; }
        .cell-text { position: relative; z-index: 5; color: #000; font-weight: 800; text-shadow: 0 0 2px rgba(255,255,255,0.3); }

        .active-tab { color: #58a6ff; border-bottom: 2px solid #58a6ff; }
        .hidden { display: none !important; }
    </style>
</head>
<body class="p-4">

    <div class="flex gap-8 mb-6 font-bold uppercase text-xs tracking-widest">
        <button onclick="setTab('ed')" id="tab-ed" class="active-tab pb-1">Редактор</button>
        <button onclick="setTab('tr')" id="tab-tr" class="opacity-50 pb-1">Тренажер</button>
    </div>

    <div class="bg-[#161b22] p-3 rounded-lg flex gap-4 mb-6 border border-[#30363d]">
        <select id="mode" onchange="syncUI()" class="bg-[#0d1117] p-1 rounded text-sm outline-none border border-gray-700">
            <option value="RFI">RFI</option>
            <option value="vsOpen">vs Open</option>
            <option value="vs3bet">vs 3-Bet</option>
        </select>
        <select id="hero" onchange="syncUI()" class="bg-[#0d1117] p-1 rounded text-sm outline-none border border-gray-700">
            <option>UTG</option><option>MP</option><option>CO</option><option>BTN</option><option>SB</option><option>BB</option>
        </select>
    </div>

    <div id="view-ed" class="flex flex-col items-center w-full max-w-[510px]">
        <div class="bg-[#161b22] p-4 rounded-xl border border-[#30363d] w-full mb-6">
            <div class="flex justify-between text-[10px] font-bold mb-2 uppercase tracking-tighter">
                <span style="color: var(--red)">Raise: <span id="v-r">30</span>%</span>
                <span style="color: var(--green)">Call: <span id="v-c">40</span>%</span>
                <span style="color: var(--blue)">Fold: <span id="v-f">30</span>%</span>
            </div>
            
            <div class="slider-root" id="s-root">
                <div class="bar-raise" id="b-r" style="width: 30%;"></div>
                <div class="bar-call" id="b-c" style="left: 30%; width: 40%;"></div>
                <div class="handle" id="h1" style="left: 30%;"></div>
                <div class="handle" id="h2" style="left: 70%;"></div>
            </div>
            <p class="text-[9px] opacity-40 mt-3 text-center uppercase">Настройте частоты и кликайте по рукам в матрице</p>
        </div>

        <div id="matrix" class="matrix shadow-2xl"></div>
        
        <div class="flex gap-4 mt-6">
            <button onclick="exportJSON()" class="text-[10px] bg-white/5 hover:bg-white/10 px-4 py-2 rounded uppercase border border-white/10">Сохранить JSON</button>
            <button onclick="rangeData={}; renderMatrix()" class="text-[10px] text-red-400 hover:underline uppercase">Очистить всё</button>
        </div>
    </div>

    <div id="view-tr" class="hidden flex flex-col items-center w-full max-w-sm">
        <p class="opacity-50 italic text-sm">Тренажер адаптирован под новые частоты</p>
        <button onclick="deal()" class="mt-4 bg-blue-600 px-6 py-2 rounded font-bold">Начать тест</button>
    </div>

<script>
    const RANKS = "AKQJT98765432".split("");
    let rangeData = {}; 
    let fR = 30, fC = 40; // Пропорции Raise и Call

    // Инициализация слайдера
    const h1 = document.getElementById('h1'), h2 = document.getElementById('h2'), sRoot = document.getElementById('s-root');
    
    function updateSliderUI() {
        document.getElementById('b-r').style.width = fR + '%';
        document.getElementById('b-c').style.left = fR + '%';
        document.getElementById('b-c').style.width = fC + '%';
        h1.style.left = fR + '%';
        h2.style.left = (fR + fC) + '%';
        
        document.getElementById('v-r').innerText = fR;
        document.getElementById('v-c').innerText = fC;
        document.getElementById('v-f').innerText = 100 - fR - fC;
    }

    [h1, h2].forEach((h, i) => {
        h.onmousedown = (e) => {
            const move = (em) => {
                let rect = sRoot.getBoundingClientRect();
                let val = Math.round(((em.clientX - rect.left) / rect.width) * 100);
                val = Math.max(0, Math.min(100, val));
                
                if (i === 0) { // Двигаем первую ручку (Рейз)
                    let total = fR + fC;
                    fR = Math.min(val, total);
                    fC = total - fR;
                } else { // Двигаем вторую ручку (Колл)
                    fC = Math.max(0, val - fR);
                }
                updateSliderUI();
            };
            window.onmousemove = move;
            window.onmouseup = () => window.onmousemove = null;
        };
    });

    function init() {
        const mx = document.getElementById('matrix');
        RANKS.forEach((r1, i) => {
            RANKS.forEach((r2, j) => {
                const combo = i < j ? r1+r2+'s' : (i > j ? r2+r1+'o' : r1+r2);
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.dataset.hand = combo;
                cell.innerHTML = `<div class="cell-bg"></div><div class="cell-text">${combo}</div>`;
                
                let drawing = false;
                cell.onmousedown = (e) => { drawing=true; paint(cell); };
                cell.onmouseenter = (e) => { if(e.buttons === 1) paint(cell); };
                mx.appendChild(cell);
            });
        });
        updateSliderUI();
        renderMatrix();
    }

    function paint(cell) {
        rangeData[cell.dataset.hand] = { r: fR, c: fC };
        renderMatrix();
    }

    function renderMatrix() {
        document.querySelectorAll('.cell').forEach(c => {
            const d = rangeData[c.dataset.hand] || { r: 0, c: 0 };
            const bg = c.querySelector('.cell-bg');
            // Рисуем пропорции в каждой клетке
            bg.innerHTML = `
                <div style="height:${d.r}%; background:var(--red)"></div>
                <div style="height:${d.c}%; background:var(--green)"></div>
                <div style="flex:1; background:var(--blue)"></div>
            `;
        });
    }

    function setTab(t) {
        document.getElementById('view-ed').classList.toggle('hidden', t!=='ed');
        document.getElementById('view-tr').classList.toggle('hidden', t!=='tr');
        document.getElementById('tab-ed').className = t==='ed' ? 'active-tab pb-1' : 'opacity-50 pb-1';
        document.getElementById('tab-tr').className = t==='tr' ? 'active-tab pb-1' : 'opacity-50 pb-1';
    }

    // Сохранение/Загрузка
    function exportJSON() {
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(rangeData, null, 2));
        const a = document.createElement('a');
        a.href = dataStr;
        a.download = `${document.getElementById('mode').value}_${document.getElementById('hero').value}.json`;
        a.click();
    }

    init();
</script>
</body>
</html>
