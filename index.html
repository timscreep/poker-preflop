<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Poker Preflop Trainer</title>
        <script src="https://cdn.tailwindcss.com"></script>
    </head>
    <body
        class="bg-neutral-900 text-neutral-100 min-h-screen flex flex-col items-center justify-center gap-6 p-6"
    >
        <div id="handBox" class="flex gap-2"></div>

        <div id="result" class="text-lg font-semibold h-6"></div>

        <div class="flex gap-3">
            <button class="btn px-4 py-2 bg-blue-600 rounded" data-act="raise">
                RAISE
            </button>
            <button class="btn px-4 py-2 bg-yellow-600 rounded" data-act="call">
                CALL
            </button>
            <button class="btn px-4 py-2 bg-red-600 rounded" data-act="fold">
                FOLD
            </button>
        </div>

        <button id="next" class="px-4 py-2 mt-2 rounded bg-neutral-700">
            Next
        </button>

        <script>
            let charts = null;
            let current = null;

            async function loadCharts() {
                const res = await fetch("charts.json");
                charts = await res.json();
            }

            function rand(arr) {
                return arr[Math.floor(Math.random() * arr.length)];
            }

            const ranks = [
                "A",
                "K",
                "Q",
                "J",
                "T",
                "9",
                "8",
                "7",
                "6",
                "5",
                "4",
                "3",
                "2",
            ];
            const suits = ["s", "h", "d", "c"];

            function sortHand(r1, r2) {
                return ranks.indexOf(r1) < ranks.indexOf(r2)
                    ? [r2, r1]
                    : [r1, r2];
            }

            function genHand() {
                let r1 = rand(ranks);
                let r2 = rand(ranks);
                let s1 = rand(suits);
                let s2 = rand(suits);

                if (r1 === r2) s1 = s2; // пары всегда оку suited не важен

                let [R1, R2] = sortHand(r1, r2);

                let combo = "";
                if (R1 === R2) {
                    combo = R1 + R2;
                } else {
                    combo = R1 + R2 + (s1 === s2 ? "s" : "o");
                }

                return { r1: R1, r2: R2, s1, s2, combo };
            }

            function suitToFile(r, s) {
                return `/deck/${r}${s}.png`;
            }

            function showHand(h) {
                const box = document.getElementById("handBox");
                box.innerHTML = "";
                box.innerHTML += `<img class="w-24" src="${suitToFile(h.r1, h.s1)}">`;
                box.innerHTML += `<img class="w-24" src="${suitToFile(h.r2, h.s2)}">`;
            }

            function nextHand() {
                current = genHand();
                showHand(current);
                document.getElementById("result").textContent = "";
            }

            async function main() {
                await loadCharts();

                nextHand();

                document.querySelectorAll(".btn").forEach((b) => {
                    b.onclick = () => {
                        const user = b.dataset.act;
                        const correct =
                            charts.open.UTG[current.combo] || "fold";

                        let res = document.getElementById("result");
                        if (user === correct) {
                            res.textContent = "✓ Correct (" + correct + ")";
                            res.className = "text-green-400 font-semibold";
                        } else {
                            res.textContent = "✗ Wrong (" + correct + ")";
                            res.className = "text-red-400 font-semibold";
                        }
                    };
                });

                document.getElementById("next").onclick = nextHand;
            }

            main();
        </script>
    </body>
</html>
